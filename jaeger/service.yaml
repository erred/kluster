apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: jaeger
spec:
  entryPoints:
    - https
  routes:
    - kind: Rule
      match: Host(`jaeger.seankhliao.com`)
      middlewares:
        - name: auth-jaeger
      services:
        - kind: Service
          name: jaeger-query
          port: 80
  tls: {}
---
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: auth-jaeger
spec:
  forwardAuth:
    address: http://pomerium.networking.svc.cluster.local/?uri=https://jaeger.seankhliao.com
---
apiVersion: v1
kind: Service
metadata:
  name: jaeger-query
  labels:
    app: jaeger-query
spec:
  ports:
    - name: query-http
      port: 80
      targetPort: jaeger-ui
      protocol: TCP
  selector:
    app: jaeger
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: jaeger-ingest
  labels:
    app: jaeger-ingest
spec:
  ports:
    - name: conf-sample
      port: 5778
      targetPort: conf-sample
      protocol: TCP
    - name: agent-compact
      port: 6831
      targetPort: agent-compact
      protocol: UDP
    - name: agent-bin
      port: 6832
      targetPort: agent-bin
      protocol: UDP
    - name: collect-bin
      port: 14268
      targetPort: collect-bin
      protocol: TCP
  selector:
    app: jaeger
  type: ClusterIP
