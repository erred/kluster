apiVersion: tekton.dev/v1alpha1
kind: Task
metadata:
  name: build-img
spec:
  inputs:
    resources:
      - name: source-repo
        type: git
    params:
      - name: pathToContext
        description: The build directory used by img
        default: /workspace/source-repo
  outputs:
    resources:
      - name: builtImage
        type: image
  steps:
    - name: build-and-push
      image: r.j3ss.co/img
      command:
        - /usr/bin/img
      args:
        - build
        - -t
        - "${outputs.resources.builtImage.url}"
        - --no-cache
        - "${inputs.params.pathToContext}"
