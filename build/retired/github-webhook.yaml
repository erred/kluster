apiVersion: tekton.dev/v1beta1
kind: TaskRun
metadata:
  name: create-webhook-15
  namespace: build
spec:
  taskSpec:
    params:
      - name: repo
        default: a-repo
    steps:
      - name: create-webhook
        image: curlimages/curl
        volumeMounts:
          - name: github-secret
            mountPath: /var/secret
        script: |
          #!/bin/sh

          curl -L -v \
            -H 'Content-Type: application/json' \
            -u seankhliao:$(cat /var/secret/token) \
            -d '{"name":"web", "events":["push"], "config": {"url": "https://buil.seankhliao.com", "secret": "asharedsecretwithgithub", "content_type":"json"}}' \
            https://api.github.com/repos/seankhliao/$(params.repo)/hooks
    volumes:
      - name: github-secret
        secret:
          secretName: github-webhook-token
