apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: simple-el
spec:
  entryPoints:
    - https
  routes:
    - kind: Rule
      match: Host(`build.seankhliao.com`)
      services:
        - kind: Service
          name: el-simple-el
          namespace: build
          port: 8080
  tls: {}
---
apiVersion: triggers.tekton.dev/v1alpha1
kind: EventListener
metadata:
  name: simple-el
spec:
  serviceAccountName: tekton-triggers-admin
  triggers:
    - name: simple-container
      interceptors:
        - github:
            secretRef:
              secretName: github-webhook-token
              secretKey: shared
            eventTypes:
        - cel:
            filter: "header.match('X-GitHub-Event', 'push') && (split(body.ref, '/')[1] == 'tags')"
            overlays:
              - key: extensions.tag_name
                expression: "split(body.ref, '/')[2]"
      bindings:
        - name: github-push
      template:
        name: simple-container
