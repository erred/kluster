apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachine
metadata:
  name: testvm8
  namespace: cdi
spec:
  running: true
  template:
    spec:
      domain:
        devices:
          disks:
            - disk:
                bus: virtio
              name: rootfs
            - name: cloudinitdisk
              disk:
                bus: virtio
          interfaces:
            - name: default
              masquerade: {}
        firmware:
          bootloader:
            efi:
              secureBoot: false
        resources:
          requests:
            memory: 2048Mi
            cpu: 1000m
      networks:
        - name: default
          pod: {}
      volumes:
        - name: rootfs
          dataVolume:
            name: arch-mkosi2
        - name: cloudinitdisk
          cloudInitNoCloud:
            userData: |
              #cloud-config
              users:
                - name: root
                  ssh_authorized_keys:
                    - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKnAmz4u5/51kPPsebDCiYTXvuftUORh/TJ4pvN3NvQa arccy@eevee

  # dataVolumeTemplates:
  #   - metadata:
  #       name: testvm7
  #     spec:
  #       pvc:
  #         storageClassName: longhorn
  #         accessModes:
  #           - ReadWriteOnce
  #         resources:
  #           requests:
  #             storage: 10Gi
  #       source:
  #         http:
  #           url: "https://mirror.pkgbuild.com/images/v20210505.21690/Arch-Linux-x86_64-cloudimg-20210505.21690.qcow2"
