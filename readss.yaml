apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: readss
spec:
  entryPoints:
    - web
    - websecure
  routes:
    - match: Host(`api.seankhliao.com`) && PathPrefix(`/readss.Lister/`)
      kind: Rule
      services:
        - name: readss
          port: 80
  tls:
    secretName: acme-prod-crt-secret
---
apiVersion: v1
kind: Service
metadata:
  name: readss
spec:
  type: ClusterIP
  ports:
    - protocol: TCP
      name: grpc-web
      port: 80
      targetPort: 8090
  selector:
    app: readss
---
kind: Deployment
apiVersion: apps/v1
metadata:
  name: readss
  labels:
    app: readss
spec:
  replicas: 1
  selector:
    matchLabels:
      app: readss
  template:
    metadata:
      labels:
        app: readss
    spec:
      containers:
        - name: readss
          image: gcr.io/com-seankhliao/readss-server
          resources:
            requests:
              cpu: 5m
            limits:
              cpu: 50m
          env:
            - name: GODEBUG
              value: tls13=1
            - name: ORIGINS
              value: "https://seankhliao.com, https://com-seankhliao.web.app, https://com-seankhliao.firebaseapp.com"
            - name: HEADERS
              value: "*"
          ports:
            - name: grpc-web
              containerPort: 8090
          volumeMounts:
            - name: subs
              mountPath: /etc/readss/
      volumes:
        - name: subs
          configMap:
            name: readsssubs
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: readsssubs
data:
  subs.csv: |
    "Google Online Security Blog","http://googleonlinesecurity.blogspot.com/atom.xml"
    "Google Cloud Platform Blog","http://googleappengine.blogspot.com/atom.xml"
    "Google Open Source Blog","http://feeds.feedburner.com/GoogleOpenSourceBlog"
    "Google AI Blog","http://googleaiblog.blogspot.com/atom.xml"
    "The Firebase Blog","http://firebase.googleblog.com/feeds/posts/default"
    "Chromium Blog","http://blog.chromium.org/feeds/posts/default"
    "Project Zero","http://googleprojectzero.blogspot.com/feeds/posts/default"
    "The Go Programming Language Blog","http://blog.golang.org/feeds/posts/default"
    "CloudFlare","https://blog.cloudflare.com/rss/"
    "Instagram Engineering","http://instagram-engineering.tumblr.com/rss"
    "GitHub Engineering","https://github.blog/engineering.atom"
    "Airbnb Engineering","https://medium.com/feed/airbnb-engineering"
    "Medium Engineering","https://medium.com/feed/medium-eng"
    "Spotify Labs","https://labs.spotify.com/feed/"
    "Dropbox Tech Blog","https://tech.dropbox.com/feed/"
    "BBC Design & Engineering","https://medium.com/feed/bbc-design-engineering"
    "Joshua Wright","http://www.joshuawright.net/rss_joshuawright.xml"
    "turnoff.us","http://turnoff.us/feed.xml"
    "What If?","http://what-if.xkcd.com/feed.atom"
    "xkcd.com","http://xkcd.com/rss.xml"
    "FaaS and Furious","https://faasandfurious.com/feed.xml"
    "Azeria-Labs","https://azeria-labs.com/feed/"
    "Dave Cheney","http://dave.cheney.net/feed"
    "Drew DeVault's Blog","https://drewdevault.com/feed.xml"
    "Jessie Frazelle's Blog","https://blog.jessfraz.com/index.xml"
    "Monica Dinculescu","http://meowni.ca/atom.xml"
    "Sirupsen","http://feeds.feedburner.com/sirupsen"
    "zwischenzugs","https://zwischenzugs.com/feed/"
    "Jessitron", "https://blog.jessitron.com/feed/"
